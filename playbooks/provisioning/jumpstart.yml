- name: Config new host in inventory
  hosts: localhost
  vars:
    new_fqdn: "{{ new_hostname + '.' + new_domainname }}"

  # roles:
  #   - role: robertdebock.bootstrap

  tasks:
    - name: Dump survey host
      ansible.builtin.debug:
        var: new_hostname

    - name: Dump survey domain
      ansible.builtin.debug:
        var: new_domainname

    - name: Dump survey ip
      ansible.builtin.debug:
        var: new_ip

    - name: Dump FQDN
      ansible.builtin.debug:
        var: new_fqdn

    - name: Add to inventory
      ansible.controller.host:
        name: crunchy
        inventory: "Manual"
        state: present
        validate_certs: false
        controller_host: loccalhost
        controller_username: '{{ lookup("env", "CONTROLLER_USERNAME") }}'
        controller_password: '{{ lookup("env", "CONTROLLER_PASSWORD") }}'
        #controller_config_file: "~/tower_cli.cfg"


    # - name: Add to inventory
    #   ansible.controller.host:
    #     name: "{{ new_fqdn }}"
    #     description: "For Testing"
    #     inventory: "Manual"
    #     state: present
    #     validate_certs: false
    #     controller_host: localhost ## To fix, needs to remotely call controller
    #     controller_username: '{{ lookup("env", "CONTROLLER_USERNAME") }}'
    #     controller_password: '{{ lookup("env", "CONTROLLER_PASSWORD") }}'
    #     #controller_config_file: "~/tower_cli.cfg"
    #     variables:
    #       foo: "{{ new_ip }}"

- name: Initial kickstart
  hosts: new_fqdn

  tasks:
    - name: Set hostname
      ansible.builtin.hostname:
        name: new_hostname
